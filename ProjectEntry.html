<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project Manager SPA</title>
<style>
* { box-sizing: border-box; }
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f8f8f8; }
header { padding: 10px; background: #007acc; color: white; display: flex; justify-content: space-between; align-items: center; }
header h1 { margin: 0; font-size: 1.4em; }
header button { padding: 5px 10px; font-size: 0.9em; cursor: pointer; margin-left: 5px; }
#projects-container { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; }
@media (max-width: 1000px) { #projects-container { grid-template-columns: 1fr; } }
.project { background: white; padding: 10px; border-radius: 5px; user-select: none; border: 1px solid #ccc; overflow: hidden; transition: max-height 0.3s ease, opacity 0.3s ease; }
.project.dragging { opacity: 0.5; }
.project-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
.project-title { flex: 1; margin-right: 5px; font-weight: bold; }
.chevron, .edit-project, .delete-project { cursor: pointer; margin-left: 5px; }
.collapsed .chevron { transform: rotate(-90deg); transition: transform 0.3s; }
.project-body { display: flex; flex-direction: column; gap: 10px; overflow: hidden; transition: max-height 0.3s ease, opacity 0.3s ease; }
.section { background: #f9f9f9; padding: 5px; border-radius: 5px; display: flex; flex-direction: column; }
.tasks { background: #eaf6ff; }
.logs { background: #f3fff0; }
.section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
.section-items { display: flex; flex-direction: column; gap: 3px; }
.item { padding: 5px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-radius: 3px; max-height: 20px; overflow: hidden; transition: max-height 0.3s ease, background 0.3s ease; }
.item span { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.item.expanded { white-space: normal; max-height: 500px; align-items: flex-start; }
.item:hover { background: rgba(0,0,0,0.05); }
.item-buttons button { background: none; border: none; cursor: pointer; margin-left: 5px; }
.add-line { display: flex; margin-top: 5px; }
.add-line input { flex: 1; padding: 3px; }
.add-line button { margin-left: 5px; }
#modal, #edit-item-modal { display: none; position: fixed; top: 0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
#modal-content, #edit-item-content { background: white; padding: 20px; border-radius: 5px; max-height: 80%; overflow-y: auto; width: 80%; }
#modal h2 { margin-top: 0; }
#edit-item-content textarea { width: 100%; height: 150px; }
#edit-item-content div { margin-top: 10px; text-align: right; }

body.dark {
  background: #181818;
  color: #e0e0e0;
}

body.dark header {
  background: #222;
  color: #fff;
}

body.dark .project {
  background: #242424;
  border-color: #444;
  color: #e0e0e0;
}

body.dark .tasks {
  background: #1f2a33; /* slightly bluish */
}

body.dark .logs {
  background: #23331f; /* slightly greenish */
}

body.dark .section-header strong {
  color: #fff;
}

body.dark input, 
body.dark textarea {
  background: #2a2a2a;
  color: #e0e0e0;
  border: 1px solid #555;
}

body.dark button {
  background: #333;
  color: #e0e0e0;
  border: 1px solid #555;
  padding: 3px 6px;
  cursor: pointer;
}

body.dark button:hover {
  background: #444;
}


</style>
</head>
<body>
<header>
  <h1>Project Manager</h1>
  <div>
    <button id="add-project">Add Project</button>
    <button id="toggle-accordion">Accordion Mode</button>
    <button id="download-status">Download Status</button>
    <button id="view-report">View Report</button>
	<button id="toggle-theme">Toggle Theme</button>

  </div>
</header>
<div id="projects-container"></div>

<!-- View All Tasks/Logs Modal -->
<div id="modal">
  <div id="modal-content">
    <h2>All Tasks and Logs</h2>
    <button id="close-modal">Close</button>
    <div id="modal-body"></div>
  </div>
</div>

<!-- Edit Task/Log Modal -->
<div id="edit-item-modal">
  <div id="edit-item-content">
    <h3>Edit Item</h3>
    <textarea id="edit-item-text"></textarea>
    <div>
      <button id="cancel-edit">Cancel</button>
      <button id="save-edit">Save</button>
    </div>
  </div>
</div>

<script>
const maxProjectsRendered = 16;
let accordionMode = false;
let draggedIndex = null;
const storageKey = 'projects_data';
let projects = JSON.parse(localStorage.getItem(storageKey) || '[]');
let currentEdit = null; // {projectIndex, sectionType, itemIndex}

function saveProjects(){ localStorage.setItem(storageKey, JSON.stringify(projects)); }

function createProjectElement(project,index){
  const projectEl = document.createElement('div');
  projectEl.className='project';
  if(project.collapsed) projectEl.classList.add('collapsed');
  projectEl.draggable=true;

  const header=document.createElement('div');
  header.className='project-header';

  const titleDiv=document.createElement('div');
  titleDiv.className='project-title';
  titleDiv.textContent=project.name;

  const editIcon=document.createElement('span');
  editIcon.textContent='âœŽ';
  editIcon.className='edit-project';
  editIcon.title='Edit Project Title';
  editIcon.addEventListener('click', e=>{
    e.stopPropagation();
    const newName = prompt('Edit project name:', project.name);
    if(newName) { project.name = newName; saveProjects(); renderProjects(); }
  });

  const chevron=document.createElement('span');
  chevron.className='chevron';
  chevron.textContent='â–¶';

  const deleteIcon = document.createElement('span');
  deleteIcon.textContent = 'ðŸ—‘';
  deleteIcon.className = 'delete-project';
  deleteIcon.title = 'Delete Project';
  deleteIcon.addEventListener('click', e=>{
    e.stopPropagation();
    if(confirm(`Are you sure you want to delete project "${project.name}"?`)){
      projects.splice(index,1);
      saveProjects();
      renderProjects();
    }
  });

  header.appendChild(titleDiv);
  header.appendChild(editIcon);
  header.appendChild(chevron);
  header.appendChild(deleteIcon);

  header.addEventListener('click', ()=>{
    toggleProjectCollapse(index);
  });

  const body=document.createElement('div');
  body.className='project-body';
  body.style.maxHeight=project.collapsed?'0px':'1000px';
  body.style.opacity=project.collapsed?'0':'1';

  ['tasks','logs'].forEach(sectionType=>{
    const section=document.createElement('div');
    section.className=`section ${sectionType}`;
    const secHeader=document.createElement('div');
    secHeader.className='section-header';
    const secTitle=document.createElement('strong');
    secTitle.textContent=sectionType.charAt(0).toUpperCase()+sectionType.slice(1);
    const clearBtn=document.createElement('button');
    clearBtn.textContent='Clear';
    clearBtn.addEventListener('click', ()=>{
      if(confirm(`Are you sure you want to clear all ${sectionType}?`)){
        project[sectionType]=[];
        saveProjects();
        renderProjects();
      }
    });
    secHeader.appendChild(secTitle);
    secHeader.appendChild(clearBtn);
    section.appendChild(secHeader);

    const itemsDiv=document.createElement('div');
    itemsDiv.className='section-items';
    project[sectionType].forEach((item,i)=>{
      const itemDiv=document.createElement('div');
      itemDiv.className='item';
      const itemText=document.createElement('span');
      itemText.textContent=sectionType==='tasks'? item.text:`${item.text} (${item.time.slice(11,16)})`;
      itemDiv.appendChild(itemText);

      const btnDiv=document.createElement('div');
      btnDiv.className='item-buttons';
      if(sectionType==='tasks'){
        const completeBtn=document.createElement('button');
        completeBtn.textContent='âœ”';
        completeBtn.title='Complete';
        completeBtn.addEventListener('click', e=>{
          e.stopPropagation();
          project.tasks.splice(i,1);
          project.logs.push({text:item.text,time:new Date().toISOString()});
          saveProjects();
          renderProjects();
        });
        btnDiv.appendChild(completeBtn);
      }
      const editBtn=document.createElement('button');
      editBtn.textContent='âœŽ';
      editBtn.title='Edit';
      editBtn.addEventListener('click', e=>{
        e.stopPropagation();
        openEditModal(index, sectionType, i);
      });
      const delBtn=document.createElement('button');
      delBtn.textContent='ðŸ—‘';
      delBtn.title='Delete';
      delBtn.addEventListener('click', e=>{
        e.stopPropagation();
        if(confirm('Are you sure you want to delete this item?')){
          project[sectionType].splice(i,1);
          saveProjects();
          renderProjects();
        }
      });
      btnDiv.appendChild(editBtn);
      btnDiv.appendChild(delBtn);
      itemDiv.appendChild(btnDiv);

      itemDiv.addEventListener('click', ()=>{
        if(itemDiv.classList.contains('expanded')){
          itemDiv.style.maxHeight='20px';
        } else {
          itemDiv.style.maxHeight=itemDiv.scrollHeight+'px';
        }
        itemDiv.classList.toggle('expanded');
      });
      itemsDiv.appendChild(itemDiv);
    });
    section.appendChild(itemsDiv);

    const addLine=document.createElement('div');
    addLine.className='add-line';
    const input=document.createElement('input');
    input.placeholder=`Add ${sectionType.slice(0,-1)}`;
    input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ addItem(project,sectionType,input.value); input.value=''; }});
    const addBtn=document.createElement('button');
    addBtn.textContent='Add';
    addBtn.addEventListener('click', ()=>{ addItem(project,sectionType,input.value); input.value=''; });
    addLine.appendChild(input);
    addLine.appendChild(addBtn);
    section.appendChild(addLine);

    body.appendChild(section);
  });

  projectEl.appendChild(header);
  projectEl.appendChild(body);

  // Drag & Drop
  projectEl.addEventListener('dragstart', ()=>{ draggedIndex=index; projectEl.classList.add('dragging'); });
  projectEl.addEventListener('dragend', ()=>{ draggedIndex=null; projectEl.classList.remove('dragging'); });
  projectEl.addEventListener('dragover', e=>{ e.preventDefault(); });
  projectEl.addEventListener('drop', ()=>{
    if(draggedIndex===null||draggedIndex===index) return;
    const [moved]=projects.splice(draggedIndex,1);
    projects.splice(index,0,moved);
    saveProjects();
    renderProjects();
  });

  return projectEl;
}

function toggleProjectCollapse(index){
  if(accordionMode){
    if(!projects[index].collapsed){
      projects[index].collapsed = true;
    } else {
      projects.forEach((p,i)=>{ p.collapsed = i!==index; });
    }
  } else {
    projects[index].collapsed = !projects[index].collapsed;
  }
  saveProjects();
  renderProjects();
}

function addItem(project,type,text){
  if(!text.trim()) return;
  if(type==='tasks') project.tasks.push({text});
  else project.logs.push({text,time:new Date().toISOString()});
  saveProjects();
  renderProjects();
}

function openEditModal(projectIndex, sectionType, itemIndex){
  currentEdit={projectIndex, sectionType, itemIndex};
  document.getElementById('edit-item-text').value = projects[projectIndex][sectionType][itemIndex].text;
  document.getElementById('edit-item-modal').style.display='flex';
}

document.getElementById('save-edit').addEventListener('click', () => {
  if(currentEdit){
    const {projectIndex, sectionType, itemIndex} = currentEdit;
    projects[projectIndex][sectionType][itemIndex].text = document.getElementById('edit-item-text').value;
    saveProjects();
    renderProjects();
    currentEdit=null;
    document.getElementById('edit-item-modal').style.display='none';
  }
});

document.getElementById('cancel-edit').addEventListener('click', ()=>{
  currentEdit=null;
  document.getElementById('edit-item-modal').style.display='none';
});

function renderProjects(){
  const container=document.getElementById('projects-container');
  container.innerHTML='';
  const projList=projects.slice(0,maxProjectsRendered);
  projList.forEach((p,i)=>{
    container.appendChild(createProjectElement(p,i));
  });
  container.style.gridTemplateColumns = accordionMode ? '1fr' : 'repeat(2,1fr)';
}

document.getElementById('add-project').addEventListener('click', ()=>{
  const name=prompt('Project name:');
  if(name){ projects.push({name,tasks:[],logs:[],collapsed:false}); saveProjects(); renderProjects(); }
});

document.getElementById('toggle-accordion').addEventListener('click', ()=>{
  accordionMode=!accordionMode;
  if(accordionMode) projects.forEach(p=>p.collapsed=true);
  saveProjects();
  renderProjects();
});

document.getElementById('download-status').addEventListener('click', ()=>{
  let content='';
  projects.forEach(p=>{
    content+=`Project: ${p.name}\nTasks:\n`;
    p.tasks.forEach(t=> content+=`- ${t.text}\n`);
    content+='Logs:\n';
    p.logs.forEach(l=>{
      const dt=new Date(l.time);
      const formatted=dt.getFullYear()+'-'+String(dt.getMonth()+1).padStart(2,'0')+'-'+String(dt.getDate()).padStart(2,'0')+' '+String(dt.getHours()).padStart(2,'0')+':'+String(dt.getMinutes()).padStart(2,'0');
      content+=`- ${l.text} (${formatted})\n`;
    });
    content+='\n';
  });
  const blob=new Blob([content],{type:'text/plain'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download='project_status.txt';
  a.click();
  URL.revokeObjectURL(url);
});

document.getElementById('view-report').addEventListener('click', ()=>{
  const modal=document.getElementById('modal');
  const body=document.getElementById('modal-body');
  body.innerHTML='';
  let combined=[];
  projects.forEach(p=>{
    p.tasks.forEach(t=> combined.push({project:p.name,type:'Task',text:t.text,time:'N/A'}));
    p.logs.forEach(l=> combined.push({project:p.name,type:'Log',text:l.text,time:l.time}));
  });
  combined.sort((a,b)=>a.time.localeCompare(b.time));
  combined.forEach(c=>{
    const div=document.createElement('div');
    div.textContent=`[${c.type}] ${c.project}: ${c.text} ${c.time!=='N/A'? '('+c.time.slice(0,16)+')':''}`;
    body.appendChild(div);
  });
  modal.style.display='flex';
});

document.getElementById('close-modal').addEventListener('click', ()=>{
  document.getElementById('modal').style.display='none';
});

renderProjects();

// Initialize theme
let currentTheme = localStorage.getItem('theme') || 'light';
document.body.classList.add(currentTheme);

document.getElementById('toggle-theme').addEventListener('click', ()=>{
  document.body.classList.remove(currentTheme);
  currentTheme = currentTheme === 'light' ? 'dark' : 'light';
  document.body.classList.add(currentTheme);
  localStorage.setItem('theme', currentTheme);
});

</script>
</body>
</html>
