<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>IST ↔ ET Time Table</title>
<style>
body { font-family: Arial, sans-serif; background:#f5f5f5; }
h1 { text-align:center; }
button { display:block; margin:10px auto; padding:8px 14px; border:none; background:#007BFF; color:white; border-radius:4px; cursor:pointer; }
button:hover { background:#0056b3; }

.table-container {
    width: 80%;
    max-width: 600px;
    margin: 20px auto;
    overflow-y: auto;
    height: 500px; /* adjust height as needed */
    border: 1px solid #ddd;
    box-shadow:0 2px 6px rgba(0,0,0,.2);
}

table { border-collapse:collapse; width: 100%; }
th, td { padding:8px 14px; border:1px solid #ddd; text-align:center; }
th { background:#007BFF; color:white; position: sticky; top: 0; z-index: 1; }
tr:nth-child(even) td { background:#fafafa; }
tr.current { background:#ffe08a !important; font-weight:bold; }
tr:hover { background:#d1ecf1 !important; cursor:pointer; }
</style>
</head>
<body>
<h1>IST ↔ ET Time Table</h1>
<button onclick="swap()">Swap IST ↔ ET</button>

<div class="table-container">
    <table>
      <thead>
        <tr><th id="leftCol">IST</th><th id="rightCol">ET</th></tr>
      </thead>
      <tbody id="timeTable"></tbody>
    </table>
</div>

<script>
let leftIsIST = true;

function buildTable() {
    const tbody = document.getElementById("timeTable");
    tbody.innerHTML = "";

    const leftTZ = leftIsIST ? "Asia/Kolkata" : "America/New_York";
    const rightTZ = leftIsIST ? "America/New_York" : "Asia/Kolkata";

    const midnightLeftUTC = getMidnightInTZ(leftTZ, new Date());

    const leftFmt = new Intl.DateTimeFormat('en-US', { timeZone:leftTZ, hour:'2-digit', minute:'2-digit', hour12:true });
    const rightFmt = new Intl.DateTimeFormat('en-US', { timeZone:rightTZ, hour:'2-digit', minute:'2-digit', hour12:true });
    const leftDateFmt = new Intl.DateTimeFormat('en-US', { timeZone:leftTZ, year:'numeric', month:'short', day:'numeric' });
    const rightDateFmt = new Intl.DateTimeFormat('en-US', { timeZone:rightTZ, year:'numeric', month:'short', day:'numeric' });

    const now = new Date();
    const nowLeftMs = now.getTime() + getOffsetMillis(now, leftTZ);

    let currentRow = null;

    for (let i = 0; i < 48; i++) {
        const slot = new Date(midnightLeftUTC.getTime() + i*30*60000);

        const leftStr = leftFmt.format(slot);
        let rightStr = rightFmt.format(slot);

        const leftDate = leftDateFmt.format(slot);
        const rightDate = rightDateFmt.format(slot);
        if (leftDate !== rightDate) rightStr += ` (${rightDate})`;

        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${leftStr}</td><td>${rightStr}</td>`;

        const slotLeftMs = slot.getTime() + getOffsetMillis(slot, leftTZ);
        if (Math.abs(slotLeftMs - nowLeftMs) <= 15*60*1000) {
            tr.classList.add('current');
            currentRow = tr;
        }

        tbody.appendChild(tr);
    }

    document.getElementById('leftCol').textContent = leftIsIST ? 'IST' : 'ET';
    document.getElementById('rightCol').textContent = leftIsIST ? 'ET' : 'IST';

    // Auto-scroll current row into view
    if(currentRow){
        currentRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}

function getMidnightInTZ(tz, refDate){
    const parts = new Intl.DateTimeFormat('en-US', {
        timeZone: tz,
        year:'numeric', month:'2-digit', day:'2-digit',
        hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false
    }).formatToParts(refDate);

    let y,m,d;
    for(const p of parts){
        if(p.type==='year') y=p.value;
        if(p.type==='month') m=p.value;
        if(p.type==='day') d=p.value;
    }

    const localMidnight = new Date(`${y}-${m}-${d}T00:00:00`);
    return new Date(localMidnight.getTime() - getOffsetMillis(localMidnight, tz));
}

function getOffsetMillis(date, tz){
    const tzDate = new Date(date.toLocaleString('en-US', { timeZone: tz }));
    return tzDate.getTime() - date.getTime();
}

function swap(){
    leftIsIST = !leftIsIST;
    buildTable();
}

buildTable();
setInterval(buildTable, 60000);
</script>
</body>
</html>
